<!DOCTYPE html>
<html lang="de">
<head>
    <!-- ... (previous head content remains the same) ... -->
</head>
<body class="p-4">
    <div class="container mx-auto mt-8 card">
        <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-6">Französisch-Verben-Quiz</h1>
        <p class="text-center text-gray-600 mb-8">
            Teste dein Wissen über französische Verbkonjugationen!
        </p>

        <div id="quizSetupScreen" class="">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">Quiz-Einstellungen</h2>
            <div class="flex flex-col md:flex-row justify-center items-start gap-6 mb-8">
                <div class="w-full md:w-1/2">
                    <label for="tenseFilter" class="block text-gray-700 text-sm font-bold mb-2">Wähle Zeitform(en):</label>
                    <select id="tenseFilter" multiple size="4" class="filter-select block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out">
                        <option value="present">Présent</option>
                        <option value="imparfait">Imparfait</option>
                        <option value="passe_compose">Passé Composé</option>
                    </select>
                </div>

                <div class="w-full md:w-1/2">
                    <label for="pronounFilter" class="block text-gray-700 text-sm font-bold mb-2">Wähle Pronomen:</label>
                    <select id="pronounFilter" multiple size="6" class="filter-select block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out">
                        <option value="je">Je</option>
                        <option value="tu">Tu</option>
                        <option value="il">Il/Elle/On</option>
                        <option value="nous">Nous</option>
                        <option value="vous">Vous</option>
                        <option value="ils">Ils/Elles</option>
                    </select>
                </div>
            </div>

            <!-- Add toggle for learning mode -->
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2">Lernmodus:</label>
                <div class="flex items-center space-x-4">
                    <label class="inline-flex items-center">
                        <input type="radio" class="form-radio text-blue-600" name="learningMode" value="groups" checked>
                        <span class="ml-2">Verben in Gruppen lernen</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" class="form-radio text-blue-600" name="learningMode" value="all">
                        <span class="ml-2">Alle Verben auf einmal lernen</span>
                    </label>
                </div>
            </div>

            <div id="seedGroupControls" class="mb-6">
                <label for="seedInput" class="block text-gray-700 text-sm font-bold mb-2">
                    Seed für Verbengruppen (optional):
                    <span id="infoIcon" class="info-icon" title="Zeigt die Verben in der aktuellen Lerngruppe an.">i</span>
                </label>
                <div class="flex items-center">
                    <input type="text" id="seedInput" class="flex-grow p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg transition duration-200 ease-in-out" placeholder="Gib hier einen Seed ein oder lasse es leer">
                    <button id="changeSeedBtn" class="btn btn-secondary ml-2 px-4 py-3 text-sm">Seed ändern</button>
                </div>
                <p class="text-sm text-gray-500 mt-2">
                    Aktueller Seed: <span id="currentSeedDisplay" class="font-semibold text-gray-700"></span>
                    <br>
                    <span class="text-xs text-gray-400">Gib einen neuen Seed oben ein und klicke auf "Seed ändern", um die Verbengruppen neu zu generieren.</span>
                </p>
            </div>

            <div id="setupFeedback" class="text-center text-xl font-bold mb-6"></div>

            <button id="startQuizBtn" class="btn btn-success w-full mb-6">Quiz starten</button>

            <div id="progressDisplay" class="bg-gray-100 p-6 rounded-lg text-gray-700 shadow-inner">
                <h3 class="text-xl font-semibold mb-3">Dein Fortschritt:</h3>
                <p class="mb-1">Insgesamt beantwortete Fragen: <span id="totalAnswered" class="font-bold text-gray-900">0</span></p>
                <p class="mb-1">Richtige Antworten: <span id="correctAnswers" class="font-bold text-green-600">0</span></p>
                <p class="mb-1">Zu wiederholende Verben: <span id="verbsToReview" class="font-bold text-red-500">0</span></p>
                <p>Studienzeit: <span id="studyTime" class="font-bold text-gray-900">0m 0s</span></p>
                <button id="clearProgressBtn" class="btn btn-danger mt-6">Fortschritt löschen</button>
            </div>
        </div>

        <!-- ... (rest of the HTML remains the same) ... -->
    </div>

    <!-- ... (modal and other elements remain the same) ... -->

    <script>
        // ... (previous script content remains the same until generateQuizSessionQuestions) ...

        /**
         * Generates the questions for the current quiz session based on the learning algorithm.
         */
        function generateQuizSessionQuestions() {
            const selectedTenses = Array.from(tenseFilter.selectedOptions).map(option => option.value);
            const selectedPronouns = Array.from(pronounFilter.selectedOptions).map(option => option.value);
            const learningMode = document.querySelector('input[name="learningMode"]:checked').value;

            if (selectedTenses.length === 0 || selectedPronouns.length === 0) {
                setupFeedbackDiv.textContent = "Bitte wähle mindestens eine Zeitform und ein Pronomen, um das Quiz zu starten.";
                setupFeedbackDiv.classList.add('feedback-info');
                return [];
            }

            // If learning all verbs at once, just use all infinitives
            if (learningMode === 'all') {
                const allInfinitives = verbsData.map(v => v.infinitive);
                let questions = [];
                
                // Generate questions from all verbs
                for (const infinitive of allInfinitives) {
                    const verb = verbsData.find(v => v.infinitive === infinitive);
                    if (!verb) continue;
                    
                    for (const tense of selectedTenses) {
                        if (!verb.conjugations[tense]) continue;
                        
                        for (const pronoun of selectedPronouns) {
                            if (!verb.conjugations[tense][pronoun]) continue;
                            
                            questions.push({
                                infinitive,
                                tense,
                                pronoun,
                                conjugation: verb.conjugations[tense][pronoun]
                            });
                        }
                    }
                }
                
                // Shuffle questions
                seededRand.shuffle(questions);
                return questions.slice(0, SESSION_TOTAL_QUESTIONS);
            }
            
            // Otherwise, use the group-based learning algorithm
            const currentGroupInfinitives = learningState.verbGroups[learningState.currentLearningGroupIndex] || [];
            const nextGroupInfinitives = learningState.verbGroups[learningState.currentLearningGroupIndex + 1] || [];
            let previousGroupsInfinitives = [];
            for (let i = 0; i < learningState.currentLearningGroupIndex; i++) {
                previousGroupsInfinitives = previousGroupsInfinitives.concat(learningState.verbGroups[i]);
            }

            let currentGroupQuestions = [];
            let nextGroupQuestions = [];
            let previousGroupQuestions = [];

            // ... (rest of the original group-based question generation logic remains the same) ...
        }

        // ... (rest of the script remains the same) ...

        // Add event listener to toggle seed group controls based on learning mode
        document.addEventListener('DOMContentLoaded', function() {
            const learningModeRadios = document.querySelectorAll('input[name="learningMode"]');
            const seedGroupControls = document.getElementById('seedGroupControls');
            
            function updateLearningModeUI() {
                const learningMode = document.querySelector('input[name="learningMode"]:checked').value;
                if (learningMode === 'all') {
                    seedGroupControls.classList.add('hidden');
                } else {
                    seedGroupControls.classList.remove('hidden');
                }
            }
            
            learningModeRadios.forEach(radio => {
                radio.addEventListener('change', updateLearningModeUI);
            });
            
            // Initialize UI
            updateLearningModeUI();
        });

        // ... (rest of the script remains the same) ...
    </script>
</body>
</html>
